<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script>

	var svg = d3.select("body").append("svg")
				.attr("width", 1000)
				.attr("height", 1000)
				.append("g")
				.attr("transform", "translate(480,480)");

	var json;

		

	d3.json("s1.json", function(error, root) {
		if (error) console.log("error");

		var focus = root;
			

		/*var pack = d3.layout.pack()
		.padding(2)
		.size([700,700])
		.value(function(d){
			if (d[0].hasOwnProperty("http://purl.org/ASN/schema/core/statementLabel")){
				switch(d[0]["http://purl.org/ASN/schema/core/statementLabel"][0]["value"]){
					case "Standard":
						return 5*Math.random()*1000;
					case "Cluster":
						return 5*Math.random()*10000;
					case "Domain" :
						return 5*Math.random()*100000;
					case "Component":
						return 5*Math.random()*1000000;
				}
			}
		});*/

		svg.append("circle")
			.attr("r", "30px")
			.attr("stroke", "green")
			.attr("stroke-width", "1.5px")
			.attr("fill", "#fff")
			.on("click", function(d) {displayDomains()});

					

		var genInfo = root["http://asn.jesandco.org/resources/D10003FB"];
		delete root["http://asn.jesandco.org/resources/D10003FB"];
		delete root["http://asn.jesandco.org/resources/D10003FB.xml"];

		var Domains = [];
		for (x in root) {
			/*
			if (root[x].hasOwnProperty("http://purl.org/dc/terms/description")){
				root[x]["name"] = root[x]["http://purl.org/dc/terms/description"][0]["value"];
			}
			root[x]["children"] = [];
			if (root[x].hasOwnProperty("http://purl.org/gem/qualifiers/hasChild")){
				for (i in root[x]["http://purl.org/gem/qualifiers/hasChild"]){
					root[x]["children"].push(root[x]["http://purl.org/gem/qualifiers/hasChild"][i]["value"]);
				}
			}*/
			
			if (root[x].hasOwnProperty("http://purl.org/ASN/schema/core/statementLabel") && root[x]["http://purl.org/ASN/schema/core/statementLabel"][0]["value"]=="Domain"){
					Domains.push(x);
			}
		}

		/*for (x in root){
			temp = [];
			temp.push(root[x]);
			nodeArray.push(pack.nodes(temp));
		}*/
		
		console.log(Domains);
		var nodeDistance = 180/Domains.length;
		var endAngle = 0;
		var beginAngle = 0;



		function displayDomains(){
			var node = svg.selectAll("g")
					.data(Domains)					
					.enter();

			var backgrounds = node.append("g")
						.attr("transform", function(d,i) {
							return "rotate("+ nodeDistance*2*i + ")translate(90)";
						})
						.attr("class", "Level2");


			var circles = backgrounds.append("circle")
				.on("click", function(d,i) {
					shiftCircles(d,i,nodeDistance*2*i);
					displayInner(d,3,nodeDistance*2*i);
				});


			circles
				.attr("fill", "#fff")
				.attr("r",0)
				.transition()
				.duration(1500)	
				.attr("r",4.5)
				.attr("stroke", "blue")
				.attr("stroke-width",0)	
				.attr("stroke-width", "1.5px")

			/*function addLines(d,i){
				var line = d3.svg.line()
				    .x(function(d) { return x(...); })
				    .y(function(d) { return y(...); })
				    .interpolate("linear");

				svg.append("path")
					.attr("class", "line")
					.attr("d", function(d){return line(data)})
					.style("stroke","#000");
			}*/


			function shiftCircles(d,i,baseRotate) {
				beginAngle = baseRotate + 90;
				endAngle = nodeDistance * (Domains.length -2) + baseRotate + 90;
				var filterCondition = d;
				var coeff = (i > Domains.length/4 && i < Domains.length*3/4 ? 1 : 0);
				var thisCircle = circles.filter(function(d){return (d===filterCondition)}).transition()
					.duration(1500)
					.attr("r", 5);
				var others = circles.filter(function(d){return !(d===filterCondition)}).transition()
					.duration(1500)
					.attr("r", 2.25);
				var otherNodes = backgrounds.filter(function(d){return !(d===filterCondition)}).transition()
					.duration(1500)
					.attr("transform", function(d,i){
						return "rotate(" + (nodeDistance*i +baseRotate + 90) + ")translate(90)";
					})
				}
			/*node.append("text")
				.attr("dy", ".31em")
				.attr("text-anchor", "start")
				.attr("transform", "translate(8)")
				.text(function(d,i){
					return root[d]["http://purl.org/dc/terms/description"][0]["value"];
				});*/
			}

		
		function displayInner(parent, coeff, baseRotate) {
			var children = root[parent]["http://purl.org/gem/qualifiers/hasChild"];
			console.log(children)
			var node2 = svg.selectAll("Level" + coeff)
				.data(children)
				.enter()


			
			var unnecessary = svg.selectAll(".Level" + (coeff))
				.remove();
			console.log("unnecessary");
			console.log(unnecessary);


			var backgrounds = node2.append("g")

			backgrounds.transition().duration(1500)
					.attr("transform", function(d,i) {
						return "rotate(" + (baseRotate - (children.length/2 - 0.5 - i) *10) + ")translate(" + 90*(coeff-1) + ")";
					})
					.attr("class", "Level" + coeff);

			var circles = backgrounds.append("circle")
					.attr("fill", "#fff")
					.attr("stroke", "blue")
					.on("click", function(d,i) {
							shiftCircles(d,i);
							displayInner(d["value"], coeff + 1, baseRotate);
						});

			circles.transition().duration(1500)
				.attr("r",5)
				.attr("stroke-width", "1.5px");
				
				


			function shiftCircles(d,i){
				var filterCondition = d;
				var thisIndex = i;
				var others = backgrounds.transition()
								.duration(1500)
								.attr("transform", function(d,i){
									if (i > thisIndex){
										return "rotate(" + (beginAngle + nodeDistance*(thisIndex - i)) + ")translate(90)";
									}
									else if (i < thisIndex){
										return "rotate(" + (endAngle + nodeDistance*(thisIndex - i)) + ")translate(90)";
									}
									else{
										return "rotate(" + baseRotate + ")translate(" + (90*(coeff-1)) + ")";
									}
								});

				var otherCircles = circles.filter(function(d){return !(d===filterCondition)})
									.attr("r", 2.25)
									.attr("stroke", "red")
									.on("click",function(d,i){
										displayInner(d["value"],coeff+1,baseRotate)});
								
				}
			}
					/*if (root[d].hasOwnProperty("http://purl.org/ASN/schema/core/statementLabel")){
						switch(root[d]["http://purl.org/ASN/schema/core/statementLabel"][0]["value"]){
							case "Standard":
								return 5;
							case "Cluster":
								return 10;
							case "Domain" :
								return 20;
							case "Component":
								return 2;
						};
						return 10;*/
						


	});
	</script>
</body>
</html>